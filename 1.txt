import { Component, OnInit } from '@angular/core';
import { FormGroup, FormControl } from '@angular/forms';
import { UserService } from './user.service'; // Import your user service
import { JobService } from './job.service'; // Import the job service

@Component({
  selector: 'app-user-registration',
  templateUrl: './user-registration.component.html',
  styleUrls: ['./user-registration.component.css']
})
export class UserRegistrationComponent implements OnInit {
  userForm: FormGroup; // Form for user registration
  jobs: any[] = []; // Array to hold job details
  jobdetails_jobid: number; // To hold the selected job ID
  message: string; // For success/error messages

  constructor(private userService: UserService, private jobService: JobService) {}

  ngOnInit(): void {
    // Fetch jobs when the component initializes
    this.jobService.getJobs().subscribe(data => {
      this.jobs = data; // Store fetched job data
    });

    // Initialize the user registration form controls
    this.userForm = new FormGroup({
      username: new FormControl(''),
      useremail: new FormControl(''),
      usermobile: new FormControl(''),
      userpassword: new FormControl(''),
      userskills: new FormControl(''),
      status: new FormControl('')
    });
  }

  // Method to handle job selection
  onJobSelect(jobId: number): void {
    this.jobdetails_jobid = jobId; // Set the selected job ID
  }

  // Method to submit the user registration form
  submitUser(): void {
    const formData = this.userForm.value; // Get form data

    // Prepare the user data to include the selected job ID
    const userData = {
      ...formData,
      jobdetails_jobid: this.jobdetails_jobid // Include the selected job ID
    };

    // Call the user service to register the user
    this.userService.registerUser(userData).subscribe(
      response => {
        this.message = 'User registered successfully!';
        console.log('Success:', response);
      },
      error => {
        this.message = 'Registration failed';
        console.error('Error:', error);
      }
    );
  }
}
