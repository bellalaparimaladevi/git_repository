import { Component, OnInit } from '@angular/core';
import { FormGroup, FormControl } from '@angular/forms';
import { UserService } from './user.service'; // Import the service

@Component({
  selector: 'app-user-registration',
  templateUrl: './user-registration.component.html',
  styleUrls: ['./user-registration.component.css']
})
export class UserRegistrationComponent implements OnInit {

  userForm: FormGroup;
  jobs: any[] = [];
  jobdetails_jobid: number | null = null;
  message: string = '';

  constructor(private userService: UserService) {}

  ngOnInit(): void {
    this.userForm = new FormGroup({
      username: new FormControl(''),
      useremail: new FormControl(''),
      usermobile: new FormControl(''),
      userpassword: new FormControl(''),
      userskills: new FormControl(''),
      status: new FormControl('')
    });

    this.loadJobs();
  }

  loadJobs(): void {
    this.userService.getJobs().subscribe(
      data => { this.jobs = data || []; },
      error => { console.error('Failed to load jobs', error); }
    );
  }

  submitUser(): void {
    if (!this.jobdetails_jobid) {
      this.message = 'Please select a job!';
      return;
    }

    const userData = {
      ...this.userForm.value,
      jobdetails_jobid: this.jobdetails_jobid
    };

    this.userService.registerUser(userData).subscribe(
      response => {
        this.message = 'User registered successfully!';
      },
      error => {
        this.message = 'Failed to register user.';
        console.error('Error:', error);
      }
    );
  }
}
